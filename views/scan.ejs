<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
		<title>工作人员扫码工具</title>
		<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
		
		<script src="/customs/framework/jquery-1.9.1.js"></script>
		<link href="/customs/framework/amazeui/amazeui.min.css" rel="stylesheet">
		<script src="/customs/framework/amazeui/amazeui.min.js"></script>
	</head>

	<body>
		<script>
			var code = '';
			wx.config({
				debug: false,
				appId: 'wx630bfbf8158108ec',
				timestamp: <%=signature.timestamp%>,
				nonceStr: '<%=signature.nonceStr%>',
				signature: '<%=signature.signature%>',
				jsApiList: [
					'checkJsApi',
					'onMenuShareTimeline',
					'onMenuShareAppMessage',
					'onMenuShareQQ',
					'onMenuShareWeibo',
					'onMenuShareQZone',
					'hideMenuItems',
					'showMenuItems',
					'hideAllNonBaseMenuItem',
					'showAllNonBaseMenuItem',
					'translateVoice',
					'startRecord',
					'stopRecord',
					'onVoiceRecordEnd',
					'playVoice',
					'onVoicePlayEnd',
					'pauseVoice',
					'stopVoice',
					'uploadVoice',
					'downloadVoice',
					'chooseImage',
					'previewImage',
					'uploadImage',
					'downloadImage',
					'getNetworkType',
					'openLocation',
					'getLocation',
					'hideOptionMenu',
					'showOptionMenu',
					'closeWindow',
					'scanQRCode',
					'chooseWXPay',
					'openProductSpecificView',
					'addCard',
					'chooseCard',
					'openCard'
				]
			});
			wx.ready(function() {
				// 9.1.2 扫描二维码并返回结果
				document.querySelector('#scanQRCode1').onclick = function() {
					wx.scanQRCode({
						needResult: 1,
						desc: 'scanQRCode desc',
						success: function(res) {
							//var o = JSON.stringify(res);
							//alert(res.resultStr);
							
							var no = res.resultStr;
							code = res.resultStr;
							$.ajax({
								type: "POST",
								url: "/service/getMaterial",
								data: {
									bookingno:no
								},
								success: function(data) {
									var mlist = '<table class="am-table am-table-bordered am-table-radius am-table-striped">';
									mlist = mlist + '<tr><th>名称</th><th>重量</th><th>金额</th></tr>';
									for(var i in data){
										mlist = mlist + '<tr>';
										mlist = mlist + '<td>'+data[i].name+'</td>';
										mlist = mlist + '<td>'+data[i].unit+'</td>';
										mlist = mlist + '<td>'+data[i].price+'</td>';
										mlist = mlist + '</tr>';
									}
									mlist += '</table>';
									$("#mlist").html(mlist);
								}
							});
						}
					});
				};
			});
			wx.error(function(res) {
				alert(res.errMsg);
			});

			function cancelMaterial(){
				if(code == ""){
					alert("请先扫描您要核销的车辆二维码");return false;
				}
							$.ajax({
								type: "POST",
								url: "/service/cancelMaterial",
								data: {
									code:code
								},
								success: function(data) {
									alert("操作成功！");
								}
							});
			}
		</script>
		<style>

		</style>
		&nbsp;&nbsp;<button type="button" id="scanQRCode1" class="am-btn am-btn-default" style="margin-top:5px">扫描车辆通关二维码</button>
		<div id="mlist"></div>
		&nbsp;&nbsp;<button type="button" onclick="cancelMaterial()" class="am-btn am-btn-success" style="margin-top:5px">核销</button>
	</body>

</html>